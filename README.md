### 代码说明文档

#### 概述

本项目是一个命令行工具，用于将EPUB格式的电子书转换为Markdown格式。它依赖于Pandoc和html2md库来完成转换任务。用户可以通过提供输入EPUB文件路径以及可选的输出Markdown文件路径来使用此工具。

#### 技术栈

- **编程语言**: Rust
- **外部库**:
  - `pandoc`: 一个通用的文档转换器。
  - `html2md`: HTML到Markdown的转换库。
  
#### 功能描述

1. **检查Pandoc安装**: 在执行任何操作之前，程序会先检查系统中是否已正确安装了Pandoc。
2. **验证输入文件**: 确保提供的输入文件是EPUB格式，并且文件存在。
3. **临时HTML生成**: 使用Pandoc将EPUB文件转换成中间HTML格式。
4. **HTML转Markdown**: 利用`html2md`库将生成的HTML内容转换为Markdown文本。
5. **写入Markdown文件**: 将转换后的Markdown内容保存到指定或默认的输出文件中。
6. **清理工作**: 删除在转换过程中创建的临时HTML文件。

#### 错误处理

程序定义了一个自定义错误类型`EpubToMdError`，用于处理可能发生的各种错误情况，包括但不限于：

- 输入错误（如文件格式不正确）
- Pandoc相关错误（如未安装、命令失败等）
- 文件IO错误（读取/写入失败）
- 使用方法错误（参数不足）

#### 主要函数与模块

- **check_pandoc()**: 检查Pandoc是否可用。
- **convert_epub_to_md(epub_path_str: &str, md_path_str: Option<&str>) -> Result<(), EpubToMdError>**: 核心转换逻辑，负责从EPUB到Markdown的整个流程。
- **main()**: 解析命令行参数并调用核心转换函数。

#### 使用方法

用户需要通过命令行运行该工具，并按照以下格式提供参数：

```bash
epub2md_rs <输入epub文件> [输出md文件]
```

其中，`<输入epub文件>`是必需的，而`[输出md文件]`是可选的。如果未提供输出文件名，则默认会在当前目录下以输入文件名为基础生成同名的`.md`文件。

#### 安装要求

为了使本工具正常工作，用户必须确保其系统上已经安装了Rust编译环境以及Pandoc。

#### 构建与运行

1. 克隆仓库或下载源码。
2. 打开终端，导航至项目根目录。
3. 运行`cargo build`构建项目。
4. 使用`cargo run -- <输入epub文件> [输出md文件]`测试运行。

#### 注意事项

- 确保Pandoc版本兼容。
- 对于大型EPUB文件，转换过程可能会花费较长时间。
- 转换质量取决于Pandoc和html2md库的支持程度，某些复杂布局或样式可能无法完全保留。

#### 版权声明

本项目遵循MIT许可证。
